(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[832],{8969:function(e,t,n){Promise.resolve().then(n.bind(n,49))},49:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var i=n(7437),r=n(2265),d=n(4234),a=n(257);function o(){let[e,t]=(0,r.useState)(),[n,o]=(0,r.useState)(null),[h,g]=(0,r.useState)(!1),[y,b]=(0,r.useState)(null),[j,m]=(0,r.useState)(""),[v,S]=(0,r.useState)([]),[w,k]=(0,r.useState)(""),[_,F]=(0,r.useState)(""),[C,R]=(0,r.useState)("");if((0,r.useEffect)(()=>{(async()=>{await (0,d.M)(a.env.NEXT_PUBLIC_LIFF_DIARY_ID),t(await (0,d.C)())})()},[]),!e)return(0,i.jsx)(s,{children:(0,i.jsx)("p",{children:"読み込み中…"})});async function z(){if(!n||!e)return;let t=new FormData;t.append("contact",e),t.append("file",n),g(!0);let i=await fetch("/api/diary/upload",{method:"POST",body:t});if(g(!1),!i.ok)return alert("アップロード失敗");let r=await i.json();b(r.entry_id),m(r.public_url),S(r.suggested),k(r.suggested[0]||"")}async function E(){let e=await fetch("/api/diary/finalize",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({entry_id:y,title:w,extra_note:_})});if(!e.ok)return alert("作成失敗");R((await e.json()).url)}return(0,i.jsxs)(s,{children:[(0,i.jsx)("h1",{style:l,children:"家族カード（絵日記）"}),!y&&(0,i.jsxs)("div",{style:u,children:[(0,i.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return o((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)}}),(0,i.jsx)("button",{onClick:z,disabled:!n||h,style:c,children:h?"アップロード中…":"アップロード"})]}),y&&!C&&(0,i.jsxs)("div",{style:u,children:[j&&(0,i.jsx)("img",{src:j,alt:"",style:{width:"100%",borderRadius:12,marginBottom:10}}),(0,i.jsx)("div",{style:{fontSize:13,color:"#444",marginBottom:6},children:"キャプション候補（自由入力もOK）"}),(0,i.jsx)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:8},children:v.map(e=>(0,i.jsx)("button",{onClick:()=>k(e),style:{padding:"6px 10px",borderRadius:999,border:"1px solid #ddd",background:w===e?"#FFEEF2":"#fff"},children:e},e))}),(0,i.jsx)("input",{value:w,onChange:e=>k(e.target.value),placeholder:"キャプションを入力",style:f}),(0,i.jsxs)("div",{style:{marginTop:10},children:[(0,i.jsx)("div",{style:{fontSize:13,color:"#444",marginBottom:6},children:"一言メモ（任意）"}),(0,i.jsx)("textarea",{value:_,onChange:e=>F(e.target.value.slice(0,80)),placeholder:"例：寝かしつけ、ありがとう！",style:p}),(0,i.jsxs)("div",{style:{textAlign:"right",fontSize:12,color:"#999"},children:[_.length,"/80"]})]}),(0,i.jsx)("button",{onClick:E,disabled:!w,style:c,children:"カードを作る"})]}),C&&(0,i.jsxs)("div",{style:u,children:[(0,i.jsx)("p",{children:"カードができました。"}),(0,i.jsx)("a",{href:C,style:x,children:"カードを開く（共有用URL）"})]})]})}function s(e){let{children:t}=e;return(0,i.jsx)("main",{style:{maxWidth:560,margin:"0 auto",padding:"20px 16px"},children:t})}let l={fontSize:22,fontWeight:700,margin:"4px 0 8px"},u={background:"#fff",border:"1px solid #eee",borderRadius:12,padding:16,marginBottom:12},c={marginTop:8,width:"100%",background:"#FF8FA3",color:"#fff",border:"none",padding:"12px",borderRadius:10,fontWeight:700,fontSize:16},p={width:"100%",height:80,border:"1px solid #ddd",borderRadius:8,padding:"10px 12px",fontSize:16},f={width:"100%",border:"1px solid #ddd",borderRadius:8,padding:"10px 12px",fontSize:16},x={display:"inline-block",padding:"10px 12px",borderRadius:10,border:"1px solid #eee",background:"#F7F7F7",textDecoration:"none",color:"#333"}},4234:function(e,t,n){"use strict";n.d(t,{C:function(){return d},M:function(){return r}});var i=n(1571);async function r(e){i.Z.isLoggedIn()||await i.Z.init({liffId:e})}async function d(){return(await i.Z.getProfile()).userId}}},function(e){e.O(0,[370,971,117,744],function(){return e(e.s=8969)}),_N_E=e.O()}]);