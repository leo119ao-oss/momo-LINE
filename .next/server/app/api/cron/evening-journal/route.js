"use strict";(()=>{var e={};e.id=677,e.ids=[677],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7790:e=>{e.exports=require("assert")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},4175:e=>{e.exports=require("tty")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},2254:e=>{e.exports=require("node:buffer")},4492:e=>{e.exports=require("node:stream")},3719:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>m,requestAsyncStorage:()=>x,routeModule:()=>l,serverHooks:()=>_,staticGenerationAsyncStorage:()=>h});var s={};t.r(s),t.d(s,{GET:()=>c});var n=t(9303),i=t(8716),o=t(670),a=t(7070),p=t(2099),u=t(8316);let d=["今日はどんな一日だった？心に残った「小さな出来事」を一つだけ思い出してみて？","今日はどんな感情が一番強かった？その瞬間を一言で言うと？","朝のおすすめ、少しでも試せた？やってみてどうだった？"];async function c(e){if(e.headers.get("authorization")!==`Bearer ${process.env.CRON_SECRET}`)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{data:r}=await u.supabaseAdmin.from("users").select("line_user_id, participants!inner(id,last_evening_sent_at)").limit(5e3),t=d[Math.floor(Math.random()*d.length)],s=[];for(let e of r||[])try{await p.d.pushMessage(e.line_user_id,{type:"text",text:`こんばんは。
${t}
（一言でもOK。あとで絵日記にできるよ）`}),await u.supabaseAdmin.from("participants").update({last_evening_sent_at:new Date().toISOString()}).eq("id",e.participants[0].id),s.push({ok:e.line_user_id})}catch(r){s.push({ng:e.line_user_id,e:String(r)})}return a.NextResponse.json({sent:s.length,results:s})}let l=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/cron/evening-journal/route",pathname:"/api/cron/evening-journal",filename:"route",bundlePath:"app/api/cron/evening-journal/route"},resolvedPagePath:"C:\\Users\\Owner\\Desktop\\momo-LINE\\src\\app\\api\\cron\\evening-journal\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:h,serverHooks:_}=l,g="/api/cron/evening-journal/route";function m(){return(0,o.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:h})}},2099:(e,r,t)=>{t.d(r,{d:()=>i});var s=t(8077);let n={channelAccessToken:process.env.LINE_CHANNEL_ACCESS_TOKEN||"",channelSecret:process.env.LINE_CHANNEL_SECRET||""},i=new s.Z(n)},8316:(e,r,t)=>{t.d(r,{supabaseAdmin:()=>s});let s=(0,t(9498).eI)("https://mkikyycrgfudodhkukng.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{persistSession:!1}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,498,972,77],()=>t(3719));module.exports=s})();