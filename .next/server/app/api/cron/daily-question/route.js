"use strict";(()=>{var e={};e.id=501,e.ids=[501],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7790:e=>{e.exports=require("assert")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},4175:e=>{e.exports=require("tty")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},2254:e=>{e.exports=require("node:buffer")},4492:e=>{e.exports=require("node:stream")},2868:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>E,requestAsyncStorage:()=>h,routeModule:()=>d,serverHooks:()=>q,staticGenerationAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{GET:()=>c});var o=t(9303),n=t(8716),i=t(670),u=t(7070),a=t(2099),p=t(8316);let l=["こんにちは。今日、お子さんの頬ってどんな手触りでした？ ふわふわ？ それとも、もちもち？","お昼ごはん、何を食べましたか？ その中で、一番『美味しい』と感じた一口はどんな味でした？","今日の空の色、覚えてますか？ もし色鉛筆で塗るとしたら、何色を選びますか？","さっき聞こえた音、何か心に残っていますか？ 子どもの笑い声？ それとも、遠くの救急車の音？","今日、何かホッと一息つけた瞬間はありましたか？ 具体的にどんな時でした？","お子さんの今日の寝顔、どんな表情でしたか？","今日見かけた景色の中で、一番きれいだなと思ったものは何ですか？"];async function c(e){try{if(!function(e){let r=e.headers.get("authorization"),t=process.env.CRON_SECRET;return t?r===`Bearer ${t}`:(console.error("CRON_SECRET is not set"),!1)}(e))return u.NextResponse.json({error:"Unauthorized"},{status:401});let{data:r,error:t}=await p.supabaseAdmin.from("participants").select("line_user_id");if(t)return console.error("Error fetching users:",t),u.NextResponse.json({error:"Failed to fetch users"},{status:500});if(!r||0===r.length)return u.NextResponse.json({message:"No users found"},{status:200});let s=function(){let e=Math.floor(Math.random()*l.length);return l[e]}(),o=[];for(let e of r)try{await a.d.pushMessage(e.line_user_id,{type:"text",text:s}),o.push({userId:e.line_user_id,status:"success"})}catch(t){let r=t instanceof Error?t.message:String(t);await p.supabaseAdmin.from("line_push_errors").insert({line_user_id:e.line_user_id,payload:{text:s},error:r}),console.error(`Error sending message to ${e.line_user_id}:`,r),o.push({userId:e.line_user_id,status:"error",error:r})}return u.NextResponse.json({message:"Daily questions sent successfully.",question:s,results:o,totalSent:o.filter(e=>"success"===e.status).length,totalErrors:o.filter(e=>"error"===e.status).length})}catch(e){return e instanceof Error?console.error("Error in daily question cron job:",e.message):console.error("An unknown error occurred in daily question cron job:",e),u.NextResponse.json({error:"Internal Server Error"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/cron/daily-question/route",pathname:"/api/cron/daily-question",filename:"route",bundlePath:"app/api/cron/daily-question/route"},resolvedPagePath:"C:\\Users\\Owner\\Desktop\\momo-LINE\\src\\app\\api\\cron\\daily-question\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:x,serverHooks:q}=d,f="/api/cron/daily-question/route";function E(){return(0,i.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:x})}},2099:(e,r,t)=>{t.d(r,{d:()=>n});var s=t(8077);let o={channelAccessToken:process.env.LINE_CHANNEL_ACCESS_TOKEN||"",channelSecret:process.env.LINE_CHANNEL_SECRET||""},n=new s.Z(o)},8316:(e,r,t)=>{t.d(r,{supabaseAdmin:()=>n});var s=t(9498);let o=process.env.SUPABASE_SERVICE_ROLE_KEY,n=(0,s.eI)("https://mkikyycrgfudodhkukng.supabase.co",o,{auth:{persistSession:!1}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,62,77],()=>t(2868));module.exports=s})();